<h1><%= @bar.name %></h1>

<img src="<%=@bar.image_url%>">
<p><%= @bar.name %> </p>
<p><%= @bar.address %> </p>
<p><%= @bar.city%>, <%=@bar.state%> <%=@bar.zip%></p>
<p><%= @bar.phone_number %></p>

<% if @bar.description %>
  <p><%= @bar.description %></p>
<% end %>

<% if @bar.rating %>
  <p>
    Our Rating: <%= @bar.rating %> / 5
  </p>
<% else %>
  <p>
    We haven't gotten around to reviewing this just yet. Check back soon!
  </p>
<% end %>

<% if @user_avg_rating.class == String%>
  <p>
    <%= @user_avg_rating %>
  </p>
<% else %>
  <p>
    Average User Rating: <%= @user_avg_rating %> / 5
  </p>
<% end %>

<% if @bar.url %>
  <p><a href="<%= @bar.url %>">Website</a></p>
<% end %>

<% if current_user %>
  <% if current_user.admin? %>
    <%= link_to "Edit Bar", edit_bar_path %>
    <%= link_to "Delete Bar", @bar, method: :delete %>
  <% end %>
<% end %>

<div id="map"></div>

<input id="address" type="hidden" value="<%= @bar.address %>">

<div id="reviews"></div>
<!-- React will render here -->

<% if @reviews.any? { |review| review.user.admin == true } %>
  <h2> Our Review </h2>
  <% @reviews.each do |review| %>
      <% if review.user.admin == true %>
        <ul>
          <li> Drinks: <%= review.drinks %> </li>
          <li> Food: <%= review.food %> </li>
          <li> Entertainment: <%= review.entertainment %> </li>
          <li> Vibe: <%= review.vibe %> </li>
          <li> Setting: <%= review.setting %> </li>
        </ul>
        <p><strong>Description: </strong><%= review.description %></p>
    <% end %>
  <% end %>
<% end %>

<% if current_user %>
  <% if current_user.reviews[0] %>
    <% can_review = true %>
    <% current_user.reviews.each do |review| %>
      <% if review.bar_id == @bar.id %>
        <% can_review = false %>
      <% end %>
    <% end %>
    <% if can_review == true %>
      <%= link_to "Create a Review", new_bar_review_path(@bar) %>
    <% end %>
  <% else %>
    <%= link_to "Create a Review", new_bar_review_path(@bar) %>
  <% end %>
<% end %>

<% if @reviews.any? { |review| review.user.admin == false } %>
  <h2> User Reviews </h2>
  <% @reviews.each do |review| %>
    <% if review.user.admin == false %>
      <div id = "review">
        <% if review.user.profile_photo %>
          <img id="profile_photo" src="<%= review.user.profile_photo %>" height=50 width=50/>
        <% end %>
        <p><strong><%= review.user.username %></strong> : <%= (review.drinks  + review.food + review.entertainment + review.vibe + review.setting) / 5 %> </p>
        <% if !review.description.blank? %>
          <p><strong>Description: </strong><%= review.description %></p>
        <% end %>
        <% if review.user == current_user %>
          <%= link_to "Edit Review", edit_bar_review_path(@bar) %>
          <%= link_to "Delete Review", bar_review_path(@bar, review), method: :delete %>
        <% end %>
        <% if current_user %>
          <% if current_user.admin? %>
            <%= link_to "Delete Review", bar_review_path(@bar, review), method: :delete %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  <% end %>
<% else %>
  <h2>Be the first to review!</h2>
<% end %>

<%= link_to "Go Back", bars_path %>

<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=<%=ENV['GOOGLE_MAPS_API_KEY']%>&callback=initMap">
</script>
